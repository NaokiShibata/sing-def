Bootstrap: docker
From: debian:bookworm-slim

%labels
  Version 1.0.0
  Description "Debian-based image with Sphinx, themes, and Altair (uv-managed venv)"

%post
  set -e
  export DEBIAN_FRONTEND=noninteractive

  # Base tools and Python
  apt-get update && apt-get install -y --no-install-recommends \
    python3 \
    python3-venv \
    python3-pip \
    build-essential \
    git \
    make \
    ca-certificates \
    curl
  rm -rf /var/lib/apt/lists/*

  # Install uv (Python package manager)
  export UV_INSTALL_DIR=/usr/local/bin
  curl -LsSf https://astral.sh/uv/install.sh | sh

  # Create an isolated virtual environment for docs
  uv venv /opt/venv

  # Python packages for documentation, themes, and visualization
  uv pip install --python /opt/venv/bin/python \
    sphinx \
    sphinxawesome-theme \
    myst-parser \
    sphinx-autobuild \
    sphinx-copybutton \
    altair \
    vega-datasets \
    typer \
    jinja2 \
    pyyaml

%environment
  export VIRTUAL_ENV=/opt/venv
  export PATH=/opt/venv/bin:/usr/local/bin:$PATH
  export PYTHONUNBUFFERED=1
  export LC_ALL=C.UTF-8
  export PIP_DISABLE_PIP_VERSION_CHECK=1

%runscript
  exec "$@"
