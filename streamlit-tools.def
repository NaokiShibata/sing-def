Bootstrap: docker
From: python:3.12-slim-bookworm

%labels
  Author "Your Name <your.email@example.com>"
  Version "0.0.1"
  Description "Lightweight streamlit and PyGWalker container Python 3.12 slim"

%environment
  PATH=/opt/venv/bin:/opt/duckdb:$PATH
  export CC=gcc
  export CXX=g++

%post
    apt-get update && \
    apt-get install --no-install-recommends -y build-essential clang wget unzip patchelf ca-certificates && \
    rm -rf /var/lib/apt/lists/*

    # DuckDB CLI バイナリを配置
    mkdir -p /opt/duckdb
    wget -q https://github.com/duckdb/duckdb/releases/download/v1.1.1/duckdb_cli-linux-amd64.zip -O /tmp/duckdb_cli.zip
    unzip /tmp/duckdb_cli.zip -d /opt/duckdb
    chmod +x /opt/duckdb/duckdb

    # python module
    pip install --root-user-action=ignore --no-cache-dir --upgrade pip
    pip install --root-user-action=ignore --no-cache-dir \
    streamlit==1.49.0 \
    duckdb>=1.1.0 \
    pygwalker>=0.4.9 \
    pywebview>=5.2 \
    pyarrow>=17.0 \
    pandas>=2.2 \
    numpy>=1.17 \
    pyyaml>=6.0 \
    nuitka>=2.7 \
    streamlit-aggrid>=1.1.8 \
    Altair>=5.5.0 \
    pydantic>=2.11 \
    threadpoolctl>=3.6.0 \
    SciPy>=1.16.2 \
    plotly>=6.3.0 \
    scikit-bio>=0.7.0 \
    matplotlib>=3.10.6 \
    adjustText>=1.3.0

    # remove cache
    rm -rf /root/.cache/pip

%runscript
  exec "$@"

%help
  streamlit and pygwalker container
